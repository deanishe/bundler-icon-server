
{% macro index_link() %}
<!-- start index_link -->
<div class="four columns">
	<p>
		<strong><a href="{{ url_for('index') }}">&laquo; Back to Home</a></strong>
	</p>
</div>
<!-- end index_link -->
{% endmacro %}

{% macro search_box(query) %}
	<!-- start search_box -->
	<form action="{{ url_for('search') }}" name="search" id="search">
		Search icons:
		<input type="search" name="query" id="query" value="{{ query }}" placeholder="Icon name">
		<input type="submit" value="Search">
	</form>

	<script type="text/javascript">
		$( document ).ready(function() {
			$("#query").focus().select();
		})
	</script>
	<!-- end search_box -->
{% endmacro %}

{% macro colour_picker() %}
	<!-- start colour_picker -->
	<div class="sixteen columns">
		<div class="four columns">
			<label for="colourpicker">Preview colour:</label>
				<input type="color" name="colourpicker" id="colourpicker">
				<button id="reset-colour">Reset colour</button>
		</div>
		<div class="four columns">
			<label for="toggle-background">
				<input type="checkbox" name="toggle-background" id="toggle-background" checked>
				Light background
			</label>
		</div>
	</div>
		<!-- <a href="" id="reset-colour">Reset colour</a> -->

	<script>
  // Template URL for preview
	var previewURL = "{{ url_for('get_icon', font='FONT', colour='COLOUR', character='CHARACTER') }}";
	var currentTheme = $.cookie('theme');
	var themeRoot = "{{ url_for('.static', filename='css/') }}";
	// Set background colour to dark/light
	function setTheme(theme) {
		var url = themeRoot + theme + '.css';
		if ( theme != currentTheme ) {
			console.log('Changing theme to :' + theme);
			$.cookie('theme', theme, { 'path': '/' });
			$('#theme').attr('href', url);
			currentTheme = theme;
		}
		/*
		if ( style == 'light' ) {
			// $( 'body' ).removeClass( 'dark' );
			$.cookie('theme', 'light', { 'path': '/' });
			$( '#toggle-background' ).prop( 'checked', true );
		} else {
			// $( 'body' ).addClass( 'dark' );
			$.cookie('theme', 'dark', { 'path': '/' });
			$( '#toggle-background' ).prop( 'checked', false );
			{# $( 'head' ).append( '<link id="dark-theme" rel="stylesheet" type="text/css" href="{{ url_for('.static', filename='css/dark.css') }}">' ); #}
		}
		console.log('set theme = ' + style );
		*/
	}

	// Set a new preview colour
	function changePreviewColour(cssColour) {

			$.cookie('previewColour', cssColour, { 'path': '/' });
			console.log( 'previewColour > ' + cssColour );

			$("span.preview").css("color", cssColour);

			if ( $("#reset-colour").prop("disabled") ) {
				$("#reset-colour").prop("disabled", false);
			}

			// Change preview links
			$("a.previewLink").each(function(index) {
				var url = previewURL.replace('COLOUR', cssColour.replace('#', ''))
														.replace('CHARACTER', $(this).text())
														.replace('FONT', $(this).data('font'));
				$(this).attr('href', url);
			});

	};

	// Reset picker, preview colours and preview links
	$("#reset-colour").click(function() {
		$("#colourpicker").spectrum("set", "#444");
		changePreviewColour('#444');
		setTheme('light');
	});

	/****************************************************************************
	 OnLoad functions
	****************************************************************************/

	$( document ).ready( function(){

		console.log( 'initialising ...' );

		var cookies = $.cookie();
		for (var i in cookies ) {
			console.log( i + ' = ' + cookies[i] );
		}

		var theme = $.cookie( 'theme' );
		var previewColour = $.cookie('previewColour' );

		if ( ! previewColour ) {
			var previewColour = '#444';
		}

		console.log( 'previewColour < ' + previewColour );
		console.log('theme < ' + theme );

		if ( theme == 'dark' ) {
			$( "#toggle-background" ).prop( 'checked', false );
			// $( 'body' ).addClass( 'dark' );
		}
		// console.log( 'theme set to dark' );


		/**************************************************************************
			Add callbacks
		**************************************************************************/

		$( "#toggle-background" ).change(function() {
			// $( "body" ).toggleClass( "dark" );
			if ( this.checked ) {  // light background
				setTheme( 'light' );
			} else {
				setTheme( 'dark' );
			}
		});

		$("#reset-colour").prop("disabled", true);

		$("#colourpicker").spectrum({
			color: previewColour,
			showInput: true,
			chooseText: "Apply",
			clickoutFiresChange: true,
			change: function(colour){
				cssColour = colour.toHexString();
				console.log( 'new preview colour : ' + cssColour );
				changePreviewColour( cssColour );
			}
		});

		/**************************************************************************
			Load saved settings
		**************************************************************************/

		changePreviewColour( previewColour );

	});

</script>
<!-- end colour_picker -->
{% endmacro %}